/****
 * Grapnel.js
 * https://github.com/EngineeringMode/Grapnel.js
 *
 * @author Greg Sabia Tucker <greg@artificer.io>
 * @link http://artificer.io
 * @version 0.5.8
 *
 * Released under MIT License. See LICENSE.txt or http://opensource.org/licenses/MIT
 *
 * changed by Tobias Nickel, to provide silence and replace options to the navigate methods.
*/
(function(c){function d(a){var b=this;this.events={};this.state=null;this.silent=!1;this.options=a||{};this.options.env=this.options.env||(0===Object.keys(c).length&&process&&!0!==process.browser?"server":"client");this.options.mode=this.options.mode||("server"!==this.options.env&&this.options.pushState&&c.history&&c.history.pushState?"pushState":"hashchange");this.version="0.5.8";"function"===typeof c.addEventListener&&(c.addEventListener("hashchange",function(){b.trigger("hashchange")}),c.addEventListener("popstate",
function(a){if(b.state&&null===b.state.previousState)return!1;b.trigger("navigate")}));this.fragment={get:function(){return"pushState"===b.options.mode?c.location.pathname.replace(b.options.root,""):"pushState"!==b.options.mode&&c.location?c.location.hash?c.location.hash.split(b.options.hashBang?"#!":"#")[1]:"":c._pathname||""},set:function(a,d){"pushState"===b.options.mode?(a=b.options.root?b.options.root+a:a,d?c.history.replaceState({},null,a):c.history.pushState({},null,a)):c.location?c.location.hash=
(b.options.hashBang?"!":"")+a:c._pathname=a||"";return b},clear:function(){"pushState"===b.options.mode?c.history.pushState({},null,b.options.root||"/"):c.location&&(c.location.hash=b.options.hashBang?"!":"");return b}};return this}d.regexRoute=function(a,b,c,d){if(a instanceof RegExp)return a;a instanceof Array&&(a="("+a.join("|")+")");a=a.concat(d?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,l,f,g){b.push({name:l,optional:!!g});
c=c||"";return""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||d&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return new RegExp("^"+a+"$",c?"":"i")};d._forEach=function(a,b){return"function"===typeof Array.prototype.forEach?Array.prototype.forEach.call(a,b):function(b,a){for(var c=0,d=this.length;c<d;++c)b.call(a,this[c],c,this)}.call(a,b)};d.prototype.get=d.prototype.add=function(a){var b=this,c=[],f=Array.prototype.slice.call(arguments,
1,-1),h=Array.prototype.slice.call(arguments,-1)[0],n=d.regexRoute(a,c),m=function(){if(b.silent)return b._clearSilent();var k=b.fragment.get().match(n);if(k){var g={params:{},keys:c,matches:k.slice(1)};d._forEach(g.matches,function(b,a){g.params[c[a]&&c[a].name?c[a].name:a]=b?decodeURIComponent(b):void 0});var e={route:a,value:b.fragment.get(),params:g.params,regex:k,stack:[],runCallback:!0,callbackRan:!1,propagateEvent:!0,next:function(){return this.stack.shift().call(b,g,e,function(){e.next.call(e)})},
preventDefault:function(){this.runCallback=!1},stopPropagation:function(){this.propagateEvent=!1},parent:function(){return this.previousState&&this.previousState.value&&this.previousState.value==this.value?this.previousState:!1},callback:function(){e.callbackRan=!0;e.timeStamp=Date.now();e.next()}};e.stack=f.concat(h);b.trigger("match",e,g);if(!e.runCallback)return b;e.previousState=b.state;b.state=e;if(e.parent()&&!1===e.parent().propagateEvent)return e.propagateEvent=!1,b;e.callback()}return b},
p="pushState"!==b.options.mode&&"server"!==b.options.env?"hashchange":"navigate";return m().on(p,m)};d.prototype.trigger=function(a){var b=this,c=Array.prototype.slice.call(arguments,1);this.events[a]&&d._forEach(this.events[a],function(a){a.apply(b,c)});return this};d.prototype.on=d.prototype.bind=function(a,b){var c=this,f=a.split(" ");d._forEach(f,function(a){c.events[a]?c.events[a].push(b):c.events[a]=[b]});return this};d.prototype.context=function(a){var b=this;return function(c,d){var h=("/"!==
a.slice(-1)?a+"/":a)+c;return b.add.call(b,h,d)}};d.prototype.navigate=function(a,b){b=b||{};var c=this;this.silent=b.silent;this.fragment.set(a,b.replace).trigger("navigate");b.replace&&b.silent&&setTimeout(function(){c._clearSilent()},1);return c};d.prototype.useLinks=function(){document.addEventListener("click",function(a){if(a.target.matches("a[href^='/']"))return this.navigate(a.target.pathname+a.target.search),a.stopPropagation(),a.preventDefault(),!1}.bind(this))};d.prototype._clearSilent=
function(){if(!this._clearSilentTimer){var a=this;this._clearSilentTimer=setTimeout(function(){a.silent=!1;a._clearSilentTimer=null},0)}return this};d.listen=function(a,b){var c,f;a&&b?(c=a,f=b):f=a;return function(){for(var a in f)this.add.call(this,a,f[a]);return this}.call(new d(c||{}))};"function"!==typeof c.define||c.define.amd.grapnel?"object"===typeof module&&"object"===typeof module.exports?module.exports=exports=d:c.Grapnel=d:c.define(function(a,b,l){c.define.amd.grapnel=!0;return d})}).call({},
"object"===typeof window?window:this);